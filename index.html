<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Cleanhands page</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/?size=160&id=0WINekHENi8b&format=png" sizes="96x96">
    <style>
        /* === å…¨å±€è®Šé‡èˆ‡åŸºç¤è¨­ç½® === */
        :root {
            --bg-color: black;
            --text-color: white;
            --primary-color: orange;
            --accent-color: #C6A300;
            --glass-bg: rgba(30, 30, 30, 0.8);
            --glass-border: rgba(255, 255, 255, 0.15);
            --grey-text: #aaa;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 20px 0 100px 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        /* === Hero æ™‚é–“é¡¯ç¤ºå€ === */
        .hero-section {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 0.8s ease-out;
            margin-top: 40px;
        }

        .hero-time {
            font-size: 4.5rem;
            font-weight: 700;
            color: #fff;
            line-height: 1;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(198, 163, 0, 0.3);
            font-variant-numeric: tabular-nums;
        }

        .hero-date {
            font-size: 2rem;
            color: var(--primary-color);
            margin-top: 10px;
            letter-spacing: 1px;
            font-weight: 400;
        }

        h1 {
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.1);
            color: #ccc;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            text-transform: uppercase;
            margin-bottom: 25px;
            letter-spacing: 1px;
            display: inline-block;
        }

        /* === ä¸»çµæœé¡¯ç¤ºå€ === */
        #result {
            font-size: 24px;
            line-height: 1.6;
            color: var(--accent-color);
            margin-top: 5px;
            padding: 20px 40px;
            border: 1px solid var(--accent-color);
            border-radius: 16px;
            background: rgba(198, 163, 0, 0.1);
            box-shadow: 0 0 30px rgba(198, 163, 0, 0.15);
            text-align: center;
            font-weight: bold;
            max-width: 90%;
            backdrop-filter: blur(5px);
            word-break: break-word;
        }

        /* === æŒ‰éˆ•å€åŸŸ === */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            width: 95%;
            max-width: 800px;
            flex-wrap: nowrap;
        }

        .button-container button {
            background-color: var(--glass-bg);
            color: #ddd;
            font-size: 15px;
            border: 1px solid var(--glass-border);
            padding: 12px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .button-container button:hover {
            background-color: rgba(255, 255, 255, 0.15);
            border-color: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }

        /* === çµæœå±•ç¤ºå¡ç‰‡ === */
        .result-box {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 25px 35px;
            margin: 30px auto;
            width: fit-content;
            max-width: 95vw;
            box-shadow: 0 15px 40px 0 rgba(0, 0, 0, 0.5);
            animation: fadeInUp 0.4s ease-out;
            box-sizing: border-box;
            display: block;
        }

        /* === æœªä¾†äº”å¤©è¡¨æ ¼ === */
        .modern-table {
            border-collapse: collapse;
            margin: 0 auto;
        }
        
        .modern-table th {
            text-align: center;
            color: var(--grey-text);
            font-size: 13px;
            padding: 0 15px 10px 15px;
            border-bottom: 1px solid var(--glass-border);
            text-transform: uppercase;
            white-space: nowrap;
        }

        .modern-table td {
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 15px;
            white-space: nowrap;
            text-align: center;
        }

        .modern-table tr:last-child td { border-bottom: none; }

        .date-start { color: #ccc; }
        .arrow { color: #666; font-size: 14px; padding: 0 5px; }
        .date-end { color: var(--primary-color); font-weight: bold; }
        .header-highlight { color: var(--accent-color); font-weight: bold; }

        /* === é©—ç®—åˆ—è¡¨ === */
        .verify-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
            gap: 40px;
            white-space: nowrap;
        }

        .verify-days-count { font-size: 32px; color: var(--accent-color); font-weight: bold; }
        .verify-days-label { color: var(--grey-text); font-size: 14px; }
        
        .verify-subtitle {
            text-align: left;
            color: #ccc;
            font-size: 14px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            white-space: nowrap;
        }

        .timeline-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .timeline-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            white-space: nowrap;
            gap: 20px;
        }

        .timeline-left { display: flex; align-items: center; gap: 12px; }

        .timeline-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background-color: #ff4d4d;
            box-shadow: 0 0 8px rgba(255, 77, 77, 0.6);
            flex-shrink: 0;
        }

        .timeline-date { color: #fff; font-size: 15px; }
        .timeline-reason { color: #ff6666; font-size: 14px; text-align: right; flex-shrink: 0; white-space: nowrap; }
        .timeline-empty { color: #4CAF50; text-align: center; padding: 15px; font-style: italic; white-space: nowrap; }

        /* é©—ç®—æ¡†ï¼šä¾å‡æœŸæ–‡å­—é•·åº¦è‡ªå‹•å¢å¯¬ï¼Œé¿å…æ©«å‘æ»¾å‹• */
        .result-box.verify-box {
            width: max-content;
            max-width: 95vw;
            min-width: min(320px, 95vw);
            overflow-x: visible;
        }
        .result-box.verify-box .timeline-list {
            overflow-x: visible;
        }

        /* === åº•éƒ¨å°èˆªæ¬„ (é‡æ§‹å„ªåŒ–ç‰ˆ) === */
        .map-button-container {
            position: fixed;
            right: 20px;
            bottom: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: fit-content;
            max-width: 800px; 
            transition: all 0.3s ease;
        }

        /* è¡Œå®¹å™¨ */
        .map-button-row {
            display: flex;
            gap: 8px;
            width: 100%;
            justify-content: flex-end; /* æ¡Œé¢ç«¯é å³ */
        }

        /* éš±è—çš„ç¬¬äºŒè¡Œ */
        #hiddenRow {
            display: none;
            width: 100%;
            justify-content: flex-start; /* æ¡Œé¢ç«¯é å·¦ï¼Œèˆ‡ç¬¬ä¸€è¡Œé½Šå¹³ */
            animation: slideUp 0.3s ease-out;
        }

        /* æŒ‰éˆ•é€šç”¨æ¨£å¼ */
        .map-button {
            background-color: #977C00;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            white-space: nowrap;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto;
            transition: transform 0.2s, background-color 0.2s;
        }
        
        .map-button:active { transform: scale(0.95); }
        .map-button-row a { text-decoration: none; }

        /* === å€’ä¸‰è§’é–‹é—œæŒ‰éˆ• === */
        #toggleBtn {
            background: transparent;
            border: none;
            box-shadow: none;
            width: 30px;
            padding: 0;
            color: #666;
            font-size: 26px; /* åœ–å½¢å†æ”¾å¤§ä¸€é»é» */
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease, color 0.3s;
            margin-left: 2px; /* èˆ‡æŒ‰éˆ•ä¿æŒæ¥µå°è·é›¢ */
        }
        
        #toggleBtn:hover { color: #aaa; transform: scale(1.1); }
        #toggleBtn.rotated { transform: rotate(180deg); }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .footer-info {
            margin-top: 20px;
            text-align: center;
            color: #555;
            font-size: 12px;
        }

        #disclaimer { margin: 0; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* === æ‰‹æ©Ÿé©é… (é‡é»ä¿®æ”¹å€) === */
        @media (max-width: 768px) {
            .hero-time { font-size: 3.5rem; }
            .hero-date { font-size: 1.5rem; }
            
            .result-box { max-width: 95%; overflow-x: auto; }
            .result-box.verify-box { max-width: 95vw; overflow-x: visible; width: max-content; }
            
            .button-container {
                gap: 8px; 
                padding: 0 10px;
            }
            
            .button-container button {
                font-size: 13px;
                padding: 10px 2px;
            }

            /* æ‰‹æ©Ÿç«¯åº•éƒ¨å°èˆªæ¬„ */
            .map-button-container {
                right: 0;
                bottom: 0;
                left: 0;
                width: 100%;
                max-width: 100vw;
                background-color: rgba(0, 0, 0, 0.95);
                backdrop-filter: blur(10px);
                padding: 6px 4px; /* æ¥µçª„é‚Šè· */
                border-top: 1px solid #333;
                gap: 6px;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
            }

            .map-button-row {
                /* å–æ¶ˆæ»‘å‹•ï¼Œæ”¹ç‚ºå½ˆæ€§åˆ†ä½ˆ */
                display: flex;
                flex-wrap: nowrap;
                justify-content: space-between; /* é—œéµï¼šç¬¬ä¸€æ’æŒ‰éˆ•å¹³å‡åˆ†ä½ˆå¡«æ»¿ */
                width: 100%;
                overflow-x: visible; /* ç¦æ­¢æ»‘å‹• */
                gap: 6px; 
            }

            /* ç¬¬äºŒæ’ (éš±è—è¡Œ) ç‰¹åˆ¥æ¨£å¼ */
            #hiddenRow {
                justify-content: flex-start; /* é—œéµï¼šç¬¬äºŒæ’é å·¦å°é½Š */
            }

            .map-button {
                font-size: 13px; /* ç¸®å°å­—é«”ä»¥å®¹ç´ Schedule */
                padding: 0 5px;  /* æ¥µçª„å…§è· */
                height: 36px;    /* é«˜åº¦ç¨å¾®å£“æ‰ */
                width: auto;
                min-width: 0;    /* å…è¨±ç¸®å° */
                white-space: nowrap;
                flex: 0 1 auto;  /* è¦–å…§å®¹å¯¬åº¦è€Œå®šï¼Œä½†å…è¨±å¾®ç¸® */
            }

            /* è®“é€£çµå®¹å™¨å…·æœ‰å½ˆæ€§ */
            .map-button-row a {
                flex: 1 1 auto; /* å…è¨±é€£çµä½”ä½ */
                min-width: 0;
                display: flex; /* è®“æŒ‰éˆ•å¡«æ»¿é€£çµ */
            }
            
            /* è®“æŒ‰éˆ•å¯¬åº¦å¡«æ»¿ a æ¨™ç±¤ */
            .map-button-row a button {
                width: 100%; 
            }

            #toggleBtn {
                width: 25px; /* å€’ä¸‰è§’ä½”ä½ç¸®å° */
                font-size: 20px;
                padding: 0;
                margin: 0;
            }

            .footer-info { margin-bottom: 140px; }
        }
    </style>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EZTW98Q8GK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-EZTW98Q8GK');
    </script> 
</head>

<body oncontextmenu="return false;">

    <div class="hero-section">
        <div id="heroTime" class="hero-time">00:00:00</div>
        <div id="heroDate" class="hero-date">Loading...</div>
    </div>

    <h1 id="randomTitle">æ—¥æœŸè¨ˆç®—</h1>
    
    <div id="result">è¨ˆç®—ä¸­...</div>
    
    <div class="button-container">
        <button onclick="toggleFutureDates()">æœªä¾†äº”å¤©</button>
        <button onclick="toggleVerification()">é©—ç®—</button>
        <button onclick="export120DaysTable()">å°å‡º120å¤©</button>
    </div>

    <div id="futureDatesTable" style="display: none;"></div>
    <div id="verificationResult" style="display: none;"></div>
    
    <div class="footer-info">
        <p id="disclaimer">è¨ˆç®—çµæœåƒ…ä¾›åƒè€ƒã€‚</p>
    </div>

    <div class="map-button-container" id="navContainer">
        <div class="map-button-row">
            <a href="schedule.html"><button class="map-button">ğŸ“… Schedule</button></a>
            <a href="salary_calculator.html"><button class="map-button">ğŸ’° è–ªä¿¸</button></a>
            <a href="age_calculator.html"><button class="map-button">ğŸ§® å¹´é½¡</button></a>
            <a href="sums_calculator.html"><button class="map-button">ğŸ”¢ ç¸½å’Œ</button></a>
            <a href="map.html"><button class="map-button">ğŸ—ºï¸ åœ°åœ–</button></a>
            <button id="toggleBtn">â–¼</button>
        </div>
        
        <div class="map-button-row" id="hiddenRow">
            <a href="https://app.iam.gov.mo/LFBPriceEnquiry" target="_blank" rel="noopener noreferrer"><button class="map-button">IAMç‰Œç…§</button></a>
            <a href="https://www.dst.gov.mo/zh-hant/public-services/licensing/licensed-entities.html" target="_blank" rel="noopener noreferrer"><button class="map-button">DSTå‡†ç…§</button></a>
            <a href="https://webmap.gis.gov.mo/InetGIS/chn/index.html" target="_blank" rel="noopener noreferrer"><button class="map-button">åœ°ç±åœ°åœ–</button></a>
            <a href="sheet.html" target="_blank" rel="noopener noreferrer"><button class="map-button">Sheet</button></a>
        </div>
    </div>

    <script>
    // ================= é…ç½®èˆ‡æ•¸æ“š =================
    const CONFIG = {
        daysToAdd: 15,
        titles: ["æˆ‘æ˜¯è¨ˆç®—å™¨"]
    };

    const WEEKDAYS = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];

    const SPECIAL_HOLIDAYS = {
        "2026-01-01": "å…ƒæ—¦",
        "2026-02-16": "è¾²æ›†é™¤å¤•(ä¸‹åˆ)",
        "2026-02-17": "è¾²æ›†æ­£æœˆåˆä¸€",
        "2026-02-18": "è¾²æ›†æ­£æœˆåˆäºŒ",
        "2026-02-19": "è¾²æ›†æ­£æœˆåˆä¸‰",
        "2026-04-03": "è€¶ç©Œå—é›£æ—¥",
        "2026-04-04": "å¾©æ´»ç¯€å‰æ—¥",
        "2026-04-05": "æ¸…æ˜ç¯€",
        "2026-04-06": "å¾©æ´»ç¯€å‰æ—¥çš„è£œå‡",
        "2026-04-07": "æ¸…æ˜ç¯€çš„è£œå‡",
        "2026-05-01": "å‹å‹•ç¯€",
        "2026-05-24": "ä½›èª•ç¯€",
        "2026-05-25": "ä½›èª•ç¯€çš„è£œå‡",
        "2026-06-19": "ç«¯åˆç¯€",
        "2026-09-26": "ä¸­ç§‹ç¯€ç¿Œæ—¥",
        "2026-09-28": "ä¸­ç§‹ç¯€ç¿Œæ—¥çš„è£œå‡",
        "2026-10-01": "ä¸­è¯äººæ°‘å…±å’Œåœ‹åœ‹æ…¶æ—¥",
        "2026-10-02": "ä¸­è¯äººæ°‘å…±å’Œåœ‹åœ‹æ…¶æ—¥ç¿Œæ—¥",
        "2026-10-18": "é‡é™½ç¯€",
        "2026-10-19": "é‡é™½ç¯€çš„è£œå‡",
        "2026-11-02": "è¿½æ€ç¯€",
        "2026-12-08": "è–æ¯ç„¡åŸç½ªç»ç¦®",
        "2026-12-20": "æ¾³é–€ç‰¹åˆ¥è¡Œæ”¿å€æˆç«‹ç´€å¿µæ—¥",
        "2026-12-21": "æ¾³é–€ç‰¹åˆ¥è¡Œæ”¿å€æˆç«‹ç´€å¿µæ—¥çš„è£œå‡",
        "2026-12-22": "å†¬è‡³",
        "2026-12-24": "è–èª•ç¯€å‰æ—¥",
        "2026-12-25": "è–èª•ç¯€",
        "2026-12-31": "é™¤å¤•(ä¸‹åˆ)"
    };

    const preventDefault = (e) => { e.preventDefault(); return false; };
    document.addEventListener('contextmenu', preventDefault);
    document.addEventListener('selectstart', preventDefault);
    document.addEventListener('copy', preventDefault);
    document.addEventListener('cut', preventDefault);
    document.addEventListener('paste', preventDefault);
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey && ['a', 'c', 'v'].includes(e.key.toLowerCase())) || e.key === 'F12') {
            preventDefault(e);
        }
    });

    function formatDateKey(date) { 
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function checkRestDay(date) {
        const dayOfWeek = date.getDay();
        const dateStr = formatDateKey(date); 
        if (dayOfWeek === 0) return { isRestDay: true, reason: "æ˜ŸæœŸæ—¥" };
        if (dayOfWeek === 6) return { isRestDay: true, reason: "æ˜ŸæœŸå…­" };
        if (SPECIAL_HOLIDAYS[dateStr]) return { isRestDay: true, reason: SPECIAL_HOLIDAYS[dateStr] };
        return { isRestDay: false, reason: "" };
    }

    function calculateWorkdayDate(startDate, daysToAdd) {
        let targetDate = new Date(startDate.getTime());
        targetDate.setHours(12, 0, 0, 0);
        targetDate.setDate(targetDate.getDate() + daysToAdd);

        let logs = [];
        while (true) {
            const status = checkRestDay(targetDate);
            if (status.isRestDay) {
                logs.push({ dateStr: formatDateKey(targetDate), dateObj: new Date(targetDate), reason: status.reason });
                targetDate.setDate(targetDate.getDate() + 1);
            } else { break; }
        }
        return { date: targetDate, logs: logs };
    }

    function updateTimeDisplays() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('zh-TW', { hour12: false });
        const dateStr = `${now.getFullYear()}å¹´${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥ ${WEEKDAYS[now.getDay()]}`;
        document.getElementById('heroTime').textContent = timeStr;
        document.getElementById('heroDate').textContent = dateStr;
    }

    function updateMainDisplay() {
        const today = new Date();
        const result = calculateWorkdayDate(today, CONFIG.daysToAdd);
        const d = result.date;
        
        document.getElementById('result').innerHTML = `
            <span style="color: #ff4d4d; font-size: 18px; display: inline-block; margin-bottom: 5px;">${CONFIG.daysToAdd}å¤©çš„æ—¥æœŸï¼š</span><br>
            ${d.getFullYear()}å¹´${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥ (${WEEKDAYS[d.getDay()]})
        `;
    }

    function toggleFutureDates() {
        const tableDiv = document.getElementById('futureDatesTable');
        const verifyDiv = document.getElementById('verificationResult');
        verifyDiv.style.display = 'none';
        if (tableDiv.style.display === 'block') {
            tableDiv.style.display = 'none';
        } else {
            let html = `
                <div class="result-box">
                    <table class="modern-table">
                        <thead>
                            <tr>
                                <th style="text-align:center;">ä»Šå¤©</th>
                                <th></th>
                                <th style="text-align:center;" class="header-highlight">ç¬¬${CONFIG.daysToAdd}å¤©</th>
                            </tr>
                        </thead>
                        <tbody>`;
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            for (let i = 0; i < 5; i++) {
                const baseDate = new Date(tomorrow.getTime() + i * 86400000);
                const res = calculateWorkdayDate(baseDate, CONFIG.daysToAdd);
                const d = res.date;
                const baseText = `${baseDate.getFullYear()}/${baseDate.getMonth() + 1}/${baseDate.getDate()} (${WEEKDAYS[baseDate.getDay()].replace('æ˜ŸæœŸ','é€±')})`;
                const resText = `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()} (${WEEKDAYS[d.getDay()].replace('æ˜ŸæœŸ','é€±')})`;
                html += `
                    <tr>
                        <td class="date-start">${baseText}</td>
                        <td class="arrow">â”</td>
                        <td class="date-end">${resText}</td>
                    </tr>`;
            }
            html += `</tbody></table><div style="text-align:center; margin-top:15px; font-size:12px; color:#666;">(æœªä¾†5å¤©é æ¸¬)</div></div>`;
            tableDiv.innerHTML = html;
            tableDiv.style.display = 'block';
        }
    }

    function toggleVerification() {
        const verifyDiv = document.getElementById('verificationResult');
        const tableDiv = document.getElementById('futureDatesTable');
        tableDiv.style.display = 'none';
        if (verifyDiv.style.display === 'block') {
            verifyDiv.style.display = 'none';
        } else {
            const today = new Date();
            const result = calculateWorkdayDate(today, CONFIG.daysToAdd);
            const endDate = result.date;
            
            const d1 = new Date(today); d1.setHours(0,0,0,0);
            const d2 = new Date(endDate); d2.setHours(0,0,0,0);
            const totalDays = Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
            
            let html = `<div class="result-box verify-box"><div class="verify-summary"><div class="verify-days-label">ç¸½è·¨åº¦å¤©æ•¸</div><div class="verify-days-count">${totalDays} å¤©</div></div>`;
            
            if (result.logs.length > 0) {
                html += `<div class="verify-subtitle">ç¬¬${CONFIG.daysToAdd}å¤©é‡åˆ°ä»¥ä¸‹å‡æœŸï¼Œéœ€è¦é †å»¶ï¼š</div>`;
                html += `<div class="timeline-list">`;
                result.logs.forEach(log => {
                    const dateShort = `${log.dateObj.getFullYear()}/${log.dateObj.getMonth()+1}/${log.dateObj.getDate()}`;
                    const weekDayShort = WEEKDAYS[log.dateObj.getDay()].replace('æ˜ŸæœŸ','');
                    html += `<div class="timeline-row"><div class="timeline-left"><span class="timeline-dot"></span><span class="timeline-date">${dateShort} (${weekDayShort})</span></div><span class="timeline-reason">${log.reason}</span></div>`;
                });
                html += `</div>`;
            } else { 
                html += `<div class="timeline-empty">â­•æœŸé–“ç„¡ä»»ä½•å‡æœŸæˆ–é€±æœ«ï¼Œç„¡éœ€é †å»¶ã€‚</div>`; 
            }
            html += `</div>`;
            verifyDiv.innerHTML = html;
            verifyDiv.style.display = 'block';
        }
    }

    function export120DaysTable() {
        try {
            const rows = [];
            rows.push('<?xml version="1.0" encoding="UTF-8"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40">');
            rows.push('<Styles><Style ss:ID="Default"><Alignment ss:Horizontal="Center" ss:Vertical="Center"/><Borders><Border ss:Position="Left" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Top" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Right" ss:LineStyle="Continuous" ss:Weight="1"/><Border ss:Position="Bottom" ss:LineStyle="Continuous" ss:Weight="1"/></Borders></Style></Styles><Worksheet ss:Name="Sheet1"><Table ss:DefaultColumnWidth="100">');
            rows.push('<Row>');
            for(let k=0; k<4; k++) { rows.push('<Cell ss:StyleID="Default"><Data ss:Type="String">æ—¥æœŸ</Data></Cell><Cell ss:StyleID="Default"><Data ss:Type="String">' + CONFIG.daysToAdd + 'æ—¥</Data></Cell>'); }
            rows.push('</Row>');
            const today = new Date();
            const totalDays = 120;
            const rowsNeeded = Math.ceil(totalDays / 4);
            for (let r = 0; r < rowsNeeded; r++) {
                rows.push('<Row>');
                for (let c = 0; c < 4; c++) {
                    const dayOffset = r + (c * rowsNeeded);
                    if (dayOffset < totalDays) {
                        const currentDate = new Date(today.getTime() + dayOffset * 86400000);
                        const res = calculateWorkdayDate(currentDate, CONFIG.daysToAdd);
                        rows.push(`<Cell ss:StyleID="Default"><Data ss:Type="String">${formatDateKey(currentDate)}</Data></Cell><Cell ss:StyleID="Default"><Data ss:Type="String">${formatDateKey(res.date)}</Data></Cell>`);
                    } else { rows.push('<Cell ss:StyleID="Default"><Data ss:Type="String"></Data></Cell><Cell ss:StyleID="Default"><Data ss:Type="String"></Data></Cell>'); }
                }
                rows.push('</Row>');
            }
            rows.push('</Table></Worksheet></Workbook>');
            const blob = new Blob([rows.join('\n')], { type: 'application/vnd.ms-excel;charset=utf-8' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `120days_calculation_${new Date().getFullYear()}.xls`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        } catch (error) { console.error('å°å‡ºå¤±æ•—:', error); alert('å°å‡ºå¤±æ•—ï¼Œè«‹æŸ¥çœ‹æ§åˆ¶å°'); }
    }

    // === åº•éƒ¨å°èˆªæ¬„æŠ˜ç–Šé‚è¼¯ ===
    function initNavToggle() {
        const toggleBtn = document.getElementById('toggleBtn');
        const hiddenRow = document.getElementById('hiddenRow');
        const navContainer = document.getElementById('navContainer');
        let isOpen = false;

        toggleBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            isOpen = !isOpen;
            
            if (isOpen) {
                hiddenRow.style.display = 'flex';
                toggleBtn.classList.add('rotated');
            } else {
                hiddenRow.style.display = 'none';
                toggleBtn.classList.remove('rotated');
            }
        });

        document.addEventListener('click', function(e) {
            if (isOpen && !navContainer.contains(e.target)) {
                isOpen = false;
                hiddenRow.style.display = 'none';
                toggleBtn.classList.remove('rotated');
            }
        });
    }

    function init() {
        document.getElementById('randomTitle').textContent = CONFIG.titles[Math.floor(Math.random() * CONFIG.titles.length)];
        updateTimeDisplays();
        updateMainDisplay();
        initNavToggle(); 
        setInterval(updateTimeDisplays, 1000);
        setInterval(updateMainDisplay, 60000);
    }
    init();
    </script>
</body>
</html>